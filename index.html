<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Namaz Timetable</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Philosopher:ital,wght@0,400;0,700;1,400;1,700&family=Nunito:wght@600;700;800;900&family=Amiri:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- ========== ANIMATED BACKGROUND LAYERS ========== -->

  <!-- Layer 1: Static geometric tile pattern -->
  <div class="geo-bg" aria-hidden="true">
    <svg class="geo-svg" viewBox="0 0 800 800" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="star8" x="0" y="0" width="120" height="120" patternUnits="userSpaceOnUse">
          <polygon points="60,5 72,40 108,40 80,62 91,97 60,76 29,97 40,62 12,40 48,40" fill="none" stroke="rgba(201,162,39,0.06)" stroke-width="0.8"/>
          <polygon points="60,18 69,44 97,44 76,60 84,86 60,70 36,86 44,60 23,44 51,44" fill="none" stroke="rgba(201,162,39,0.03)" stroke-width="0.5"/>
        </pattern>
        <pattern id="hexGrid" x="0" y="0" width="60" height="104" patternUnits="userSpaceOnUse">
          <polygon points="30,2 58,17 58,47 30,62 2,47 2,17" fill="none" stroke="rgba(201,162,39,0.045)" stroke-width="0.6"/>
          <polygon points="30,54 58,69 58,99 30,114 2,99 2,69" fill="none" stroke="rgba(201,162,39,0.045)" stroke-width="0.6"/>
          <polygon points="60,28 88,43 88,73 60,88 32,73 32,43" fill="none" stroke="rgba(201,162,39,0.045)" stroke-width="0.6"/>
        </pattern>
      </defs>
      <rect width="800" height="800" fill="url(#hexGrid)"/>
      <rect width="800" height="800" fill="url(#star8)"/>
    </svg>

    <!-- Floating ambient orbs -->
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
    <div class="orb orb-4"></div>
  </div>

  <!-- Layer 2: Aurora light beams -->
  <div class="aurora-layer" aria-hidden="true">
    <div class="aurora aurora-1"></div>
    <div class="aurora aurora-2"></div>
    <div class="aurora aurora-3"></div>
  </div>

  <!-- Layer 3: Rotating mandala rings (CSS animated) -->
  <div class="mandala-layer" aria-hidden="true">
    <!-- Large outer mandala top-right -->
    <div class="mandala mandala-tr">
      <svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
        <g transform="translate(200,200)">
          <!-- Ring 1 -->
          <circle r="180" fill="none" stroke="rgba(201,162,39,0.04)" stroke-width="1"/>
          <circle r="155" fill="none" stroke="rgba(201,162,39,0.06)" stroke-width="0.5"/>
          <!-- 8-point star outer -->
          <g class="mandala-ring-1">
            <polygon points="0,-175 8,-8 175,0 8,8 0,175 -8,8 -175,0 -8,-8" fill="none" stroke="rgba(201,162,39,0.07)" stroke-width="0.8"/>
            <polygon points="0,-155 6,-6 155,0 6,6 0,155 -6,6 -155,0 -6,-6" fill="none" stroke="rgba(201,162,39,0.05)" stroke-width="0.5"/>
          </g>
          <!-- Petals ring -->
          <g class="mandala-ring-2">
            <ellipse cx="0" cy="-120" rx="12" ry="30" fill="none" stroke="rgba(201,162,39,0.08)" stroke-width="0.7" transform="rotate(0)"/>
            <ellipse cx="0" cy="-120" rx="12" ry="30" fill="none" stroke="rgba(201,162,39,0.08)" stroke-width="0.7" transform="rotate(45)"/>
            <ellipse cx="0" cy="-120" rx="12" ry="30" fill="none" stroke="rgba(201,162,39,0.08)" stroke-width="0.7" transform="rotate(90)"/>
            <ellipse cx="0" cy="-120" rx="12" ry="30" fill="none" stroke="rgba(201,162,39,0.08)" stroke-width="0.7" transform="rotate(135)"/>
            <ellipse cx="0" cy="-120" rx="12" ry="30" fill="none" stroke="rgba(201,162,39,0.08)" stroke-width="0.7" transform="rotate(180)"/>
            <ellipse cx="0" cy="-120" rx="12" ry="30" fill="none" stroke="rgba(201,162,39,0.08)" stroke-width="0.7" transform="rotate(225)"/>
            <ellipse cx="0" cy="-120" rx="12" ry="30" fill="none" stroke="rgba(201,162,39,0.08)" stroke-width="0.7" transform="rotate(270)"/>
            <ellipse cx="0" cy="-120" rx="12" ry="30" fill="none" stroke="rgba(201,162,39,0.08)" stroke-width="0.7" transform="rotate(315)"/>
          </g>
          <!-- Inner geometric -->
          <g class="mandala-ring-3">
            <polygon points="0,-80 46,-46 80,0 46,46 0,80 -46,46 -80,0 -46,-46" fill="none" stroke="rgba(201,162,39,0.1)" stroke-width="0.8"/>
            <polygon points="0,-60 35,-35 60,0 35,35 0,60 -35,35 -60,0 -35,-35" fill="none" stroke="rgba(45,90,61,0.2)" stroke-width="0.6"/>
          </g>
          <!-- Centre star -->
          <polygon points="0,-20 5,-5 20,0 5,5 0,20 -5,5 -20,0 -5,-5" fill="none" stroke="rgba(201,162,39,0.15)" stroke-width="0.8"/>
          <circle r="6" fill="none" stroke="rgba(201,162,39,0.2)" stroke-width="0.8"/>
        </g>
      </svg>
    </div>

    <!-- Smaller mandala bottom-left -->
    <div class="mandala mandala-bl">
      <svg viewBox="0 0 280 280" xmlns="http://www.w3.org/2000/svg">
        <g transform="translate(140,140)">
          <circle r="130" fill="none" stroke="rgba(201,162,39,0.04)" stroke-width="0.8"/>
          <g class="mandala-bl-ring1">
            <polygon points="0,-120 7,-7 120,0 7,7 0,120 -7,7 -120,0 -7,-7" fill="none" stroke="rgba(201,162,39,0.07)" stroke-width="0.7"/>
          </g>
          <g class="mandala-bl-ring2">
            <ellipse cx="0" cy="-80" rx="9" ry="22" fill="none" stroke="rgba(201,162,39,0.07)" stroke-width="0.6" transform="rotate(0)"/>
            <ellipse cx="0" cy="-80" rx="9" ry="22" fill="none" stroke="rgba(201,162,39,0.07)" stroke-width="0.6" transform="rotate(60)"/>
            <ellipse cx="0" cy="-80" rx="9" ry="22" fill="none" stroke="rgba(201,162,39,0.07)" stroke-width="0.6" transform="rotate(120)"/>
            <ellipse cx="0" cy="-80" rx="9" ry="22" fill="none" stroke="rgba(201,162,39,0.07)" stroke-width="0.6" transform="rotate(180)"/>
            <ellipse cx="0" cy="-80" rx="9" ry="22" fill="none" stroke="rgba(201,162,39,0.07)" stroke-width="0.6" transform="rotate(240)"/>
            <ellipse cx="0" cy="-80" rx="9" ry="22" fill="none" stroke="rgba(201,162,39,0.07)" stroke-width="0.6" transform="rotate(300)"/>
          </g>
          <polygon points="0,-45 26,-26 45,0 26,26 0,45 -26,26 -45,0 -26,-26" fill="none" stroke="rgba(201,162,39,0.1)" stroke-width="0.7"/>
          <circle r="12" fill="none" stroke="rgba(201,162,39,0.12)" stroke-width="0.7"/>
        </g>
      </svg>
    </div>

    <!-- Tiny accent mandala mid-left -->
    <div class="mandala mandala-ml">
      <svg viewBox="0 0 160 160" xmlns="http://www.w3.org/2000/svg">
        <g transform="translate(80,80)">
          <circle r="72" fill="none" stroke="rgba(201,162,39,0.05)" stroke-width="0.6"/>
          <g class="mandala-ml-spin">
            <polygon points="0,-65 4,-4 65,0 4,4 0,65 -4,4 -65,0 -4,-4" fill="none" stroke="rgba(201,162,39,0.08)" stroke-width="0.6"/>
            <polygon points="0,-50 3,-3 50,0 3,3 0,50 -3,3 -50,0 -3,-3" fill="none" stroke="rgba(45,90,61,0.15)" stroke-width="0.5"/>
          </g>
          <circle r="10" fill="none" stroke="rgba(201,162,39,0.12)" stroke-width="0.6"/>
        </g>
      </svg>
    </div>
  </div>

  <!-- Layer 4: Crescent moon -->
  <div class="crescent-deco" aria-hidden="true">
    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="crescGrad" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="rgba(201,162,39,0.3)"/>
          <stop offset="70%" stop-color="rgba(201,162,39,0.08)"/>
          <stop offset="100%" stop-color="rgba(201,162,39,0)"/>
        </radialGradient>
        <filter id="crescGlow">
          <feGaussianBlur stdDeviation="3" result="blur"/>
          <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>
      <!-- Glow halo -->
      <circle cx="95" cy="100" r="88" fill="url(#crescGrad)" opacity="0.4"/>
      <!-- Main crescent stroke -->
      <circle cx="95" cy="100" r="78" fill="none" stroke="rgba(201,162,39,0.2)" stroke-width="1.2" filter="url(#crescGlow)"/>
      <!-- Masking circle -->
      <circle cx="122" cy="92" r="68" fill="rgba(8,21,16,0.97)"/>
      <!-- Inner glow ring on crescent edge -->
      <circle cx="95" cy="100" r="78" fill="rgba(201,162,39,0.03)"/>
    </svg>
    <!-- Star near moon -->
    <div class="moon-star">✦</div>
  </div>

  <!-- Layer 5: Shooting stars canvas -->
  <canvas id="shootingCanvas" class="shooting-canvas" aria-hidden="true"></canvas>

  <!-- Layer 6: Floating dust/particle specks -->
  <div class="dust-layer" aria-hidden="true" id="dustContainer"></div>

  <!-- Layer 7: Twinkling stars -->
  <div class="stars" aria-hidden="true" id="starsContainer"></div>

  <div id="app">
    <!-- Ornamental top border -->
    <div class="ornament-top" aria-hidden="true">
      <svg viewBox="0 0 760 30" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
        <defs>
          <linearGradient id="ornGrad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="transparent"/>
            <stop offset="20%" stop-color="rgba(201,162,39,0.6)"/>
            <stop offset="50%" stop-color="rgba(201,162,39,1)"/>
            <stop offset="80%" stop-color="rgba(201,162,39,0.6)"/>
            <stop offset="100%" stop-color="transparent"/>
          </linearGradient>
        </defs>
        <line x1="0" y1="15" x2="760" y2="15" stroke="url(#ornGrad)" stroke-width="1"/>
        <g fill="rgba(201,162,39,0.8)" transform="translate(380,15)">
          <!-- Central diamond motif -->
          <polygon points="0,-8 5,-3 0,8 -5,-3" opacity="0.9"/>
          <polygon points="-20,-4 -15,0 -20,4 -25,0" opacity="0.6"/>
          <polygon points="20,-4 25,0 20,4 15,0" opacity="0.6"/>
          <circle cx="-40" cy="0" r="2" opacity="0.4"/>
          <circle cx="40" cy="0" r="2" opacity="0.4"/>
          <circle cx="-60" cy="0" r="1.5" opacity="0.25"/>
          <circle cx="60" cy="0" r="1.5" opacity="0.25"/>
        </g>
      </svg>
    </div>

    <header class="header">
      <div class="header-inner">
        <div class="bismillah" aria-label="Bismillah">بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيم</div>
        <h1 id="headerTitle">Today's Namaz Timings</h1>
        <p class="current-date" id="currentDate">—</p>
      </div>
      <div class="actions actions-top">
        <button type="button" class="btn btn-primary" id="viewMonthlyBtn">
          <span class="btn-icon">◈</span>
          <span>Monthly Timetable</span>
          <span class="btn-ripple"></span>
        </button>
        <button type="button" class="btn btn-primary hidden" id="viewTodayBtn">
          <span class="btn-icon">◈</span>
          <span>Today's Timings</span>
          <span class="btn-ripple"></span>
        </button>
      </div>
    </header>

    <!-- Divider -->
    <div class="section-divider" aria-hidden="true">
      <svg viewBox="0 0 760 20" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
        <defs>
          <linearGradient id="divGrad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="transparent"/>
            <stop offset="30%" stop-color="rgba(45,90,61,0.8)"/>
            <stop offset="50%" stop-color="rgba(201,162,39,0.5)"/>
            <stop offset="70%" stop-color="rgba(45,90,61,0.8)"/>
            <stop offset="100%" stop-color="transparent"/>
          </linearGradient>
        </defs>
        <line x1="0" y1="10" x2="760" y2="10" stroke="url(#divGrad)" stroke-width="1"/>
        <circle cx="380" cy="10" r="3" fill="rgba(201,162,39,0.6)"/>
        <circle cx="360" cy="10" r="1.5" fill="rgba(201,162,39,0.3)"/>
        <circle cx="400" cy="10" r="1.5" fill="rgba(201,162,39,0.3)"/>
      </svg>
    </div>

    <main class="main">
      <div id="loading" class="loading hidden">
        <div class="loading-inner">
          <div class="loader-ring"></div>
          <div class="loader-ring loader-ring-2"></div>
          <div class="loader-star">✦</div>
        </div>
        <p class="loading-text">Loading Prayer Times…</p>
      </div>

      <div id="error" class="error hidden"></div>

      <div id="todayView" class="view">
        <div id="countdownSection" class="countdown-section hidden">
          <div class="countdown-glow" aria-hidden="true"></div>
          <p class="countdown-label">✦ Next Prayer ✦</p>
          <p class="countdown-prayer" id="countdownPrayerName">—</p>
          <div class="countdown-timer-wrap">
            <div class="countdown-digits" id="countdownTime">—</div>
          </div>
        </div>

        <div id="noDataToday" class="no-data hidden">
          No prayer times found for today.
        </div>

        <div id="todayCard" class="card hidden">
          <div class="card-inner-glow" aria-hidden="true"></div>
          <div class="card-header-ornament" aria-hidden="true">
            <svg viewBox="0 0 400 24" xmlns="http://www.w3.org/2000/svg">
              <line x1="0" y1="12" x2="160" y2="12" stroke="rgba(201,162,39,0.4)" stroke-width="0.5"/>
              <polygon points="200,4 208,12 200,20 192,12" fill="rgba(201,162,39,0.6)"/>
              <circle cx="175" cy="12" r="2" fill="rgba(201,162,39,0.35)"/>
              <circle cx="225" cy="12" r="2" fill="rgba(201,162,39,0.35)"/>
              <line x1="240" y1="12" x2="400" y2="12" stroke="rgba(201,162,39,0.4)" stroke-width="0.5"/>
            </svg>
          </div>
          <table class="prayer-table" aria-label="Today's prayer times">
            <tbody id="todayTableBody"></tbody>
          </table>
        </div>
      </div>

      <div id="monthlyView" class="view hidden">
        <div class="monthly-controls">
          <button type="button" class="btn btn-nav" id="prevMonth">
            <span>‹</span>
          </button>
          <h2 class="month-title" id="monthTitle">—</h2>
          <button type="button" class="btn btn-nav" id="nextMonth">
            <span>›</span>
          </button>
        </div>

        <div id="noDataMonth" class="no-data hidden">
          No prayer times found for this month.
        </div>

        <div class="table-wrapper" id="monthTableWrapper">
          <div class="table-h-scroll" id="monthTableHScroll">
            <div class="table-h-inner">
              <div class="table-header-wrap">
                <table class="month-table month-table-header" aria-hidden="true">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Fajr</th>
                      <th>Sunrise</th>
                      <th>Zahwa</th>
                      <th>Zuhr</th>
                      <th>Asr</th>
                      <th>Maghrib</th>
                      <th>Isha</th>
                    </tr>
                  </thead>
                </table>
              </div>
              <div class="table-scroll-inner" id="monthTableScrollInner">
                <table class="month-table" id="monthTable" aria-label="Monthly prayer times">
                  <tbody id="monthTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Bottom ornament -->
    <div class="ornament-bottom" aria-hidden="true">
      <svg viewBox="0 0 760 30" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
        <defs>
          <linearGradient id="botGrad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="transparent"/>
            <stop offset="20%" stop-color="rgba(201,162,39,0.3)"/>
            <stop offset="50%" stop-color="rgba(201,162,39,0.6)"/>
            <stop offset="80%" stop-color="rgba(201,162,39,0.3)"/>
            <stop offset="100%" stop-color="transparent"/>
          </linearGradient>
        </defs>
        <line x1="0" y1="15" x2="760" y2="15" stroke="url(#botGrad)" stroke-width="1"/>
        <g fill="none" stroke="rgba(201,162,39,0.5)" stroke-width="0.8" transform="translate(380,15)">
          <polygon points="0,-6 4,-2 0,6 -4,-2"/>
          <polygon points="-15,-3 -11,0 -15,3 -19,0" opacity="0.5"/>
          <polygon points="15,-3 19,0 15,3 11,0" opacity="0.5"/>
        </g>
      </svg>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="app.js"></script>
  <script>
    /* ===== TWINKLING STARS (reduced count for performance) ===== */
    const starContainer = document.getElementById('starsContainer');
    const starCount = window.matchMedia('(max-width: 768px)').matches ? 25 : 55;
    for (let i = 0; i < starCount; i++) {
      const star = document.createElement('div');
      const size = Math.random() * 2.5 + 0.5;
      // Some stars are cross/sparkle shaped
      const isSpark = Math.random() < 0.08;
      star.className = isSpark ? 'star star-spark' : 'star';
      star.style.cssText = `
        left: ${Math.random() * 100}%;
        top: ${Math.random() * 100}%;
        width: ${size}px;
        height: ${size}px;
        animation-delay: ${Math.random() * 8}s;
        animation-duration: ${1.5 + Math.random() * 5}s;
        opacity: ${Math.random() * 0.5 + 0.1};
      `;
      starContainer.appendChild(star);
    }

    /* ===== DUST PARTICLES (reduced count for performance) ===== */
    const dustContainer = document.getElementById('dustContainer');
    const dustCount = window.matchMedia('(max-width: 768px)').matches ? 8 : 18;
    for (let i = 0; i < dustCount; i++) {
      const dust = document.createElement('div');
      dust.className = 'dust-particle';
      const size = Math.random() * 3 + 1;
      const startX = Math.random() * 100;
      const duration = 15 + Math.random() * 25;
      const delay = Math.random() * 20;
      dust.style.cssText = `
        left: ${startX}%;
        bottom: -10px;
        width: ${size}px;
        height: ${size}px;
        animation-duration: ${duration}s;
        animation-delay: -${delay}s;
        opacity: ${Math.random() * 0.25 + 0.05};
      `;
      dustContainer.appendChild(dust);
    }

    /* ===== SHOOTING STARS (Canvas) — disabled on mobile for performance ===== */
    const canvas = document.getElementById('shootingCanvas');
    const isMobile = window.matchMedia('(max-width: 768px)').matches;
    if (!isMobile && canvas) {
      const ctx = canvas.getContext('2d');

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      const shooters = [];

      function createShooter() {
        const angle = (Math.random() * 30 + 15) * (Math.PI / 180); // 15–45 deg
        const startX = Math.random() * canvas.width * 0.7;
        const startY = Math.random() * canvas.height * 0.3;
        const speed = 6 + Math.random() * 8;
        const length = 80 + Math.random() * 120;
        return {
          x: startX, y: startY,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          length, alpha: 1,
          tail: []
        };
      }

    let shooterTimer = 0;
    const MAX_SHOOTERS = 2;

    function animateShooting() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      shooterTimer++;
      if (shooters.length < MAX_SHOOTERS && (shooterTimer % 220 === 0 || (shooterTimer % 120 === 0 && Math.random() < 0.25))) {
        shooters.push(createShooter());
      }

      for (let i = shooters.length - 1; i >= 0; i--) {
        const s = shooters[i];
        s.tail.push({ x: s.x, y: s.y });
        if (s.tail.length > 18) s.tail.shift();

        s.x += s.vx;
        s.y += s.vy;
        s.alpha -= 0.018;

        if (s.alpha <= 0 || s.x > canvas.width + 50 || s.y > canvas.height + 50) {
          shooters.splice(i, 1);
          continue;
        }

        // Draw tail gradient
        for (let j = 1; j < s.tail.length; j++) {
          const t = j / s.tail.length;
          ctx.beginPath();
          ctx.moveTo(s.tail[j-1].x, s.tail[j-1].y);
          ctx.lineTo(s.tail[j].x, s.tail[j].y);
          ctx.strokeStyle = `rgba(201,162,39,${t * s.alpha * 0.7})`;
          ctx.lineWidth = t * 2;
          ctx.stroke();
        }

        // Draw head glow
        const grad = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, 4);
        grad.addColorStop(0, `rgba(240,216,120,${s.alpha})`);
        grad.addColorStop(1, 'rgba(201,162,39,0)');
        ctx.beginPath();
        ctx.arc(s.x, s.y, 4, 0, Math.PI * 2);
        ctx.fillStyle = grad;
        ctx.fill();
      }

      requestAnimationFrame(animateShooting);
    }
    animateShooting();
    }
  </script>
</body>
</html>
